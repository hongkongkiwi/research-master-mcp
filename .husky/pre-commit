#!/usr/bin/env sh
# Run formatting, linting, and actionlint checks before commit

# Change to repo root
cd "$(dirname "$0")" || exit 1

echo "Checking code formatting..."
cargo fmt --all -- --check
FMT_EXIT=$?

if [ $FMT_EXIT -ne 0 ]; then
    echo "Formatting check failed. Run 'cargo fmt --all' to fix."
    exit 1
fi

echo "Running clippy..."
cargo clippy --all-features --all-targets -- -D warnings
CLIPPY_EXIT=$?

if [ $CLIPPY_EXIT -ne 0 ]; then
    echo "Clippy failed. Please fix the warnings above."
    exit 1
fi

echo "Running actionlint..."
actionlint
ACTIONLINT_EXIT=$?

if [ $ACTIONLINT_EXIT -ne 0 ]; then
    echo "Actionlint failed. Please fix the workflow issues above."
    exit 1
fi

echo "All checks passed!"
exit 0
